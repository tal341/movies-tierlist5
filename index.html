<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movies31 Tier List</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #222; color: #fff; }
    header { padding: 10px; background: #111; text-align: center; }
    .container { padding: 20px; }
    .tier { display: flex; align-items: flex-start; flex-wrap: wrap; gap: 15px; background: #333; margin-bottom: 15px; padding: 10px; border-radius: 6px; }
    .tier-label { font-weight: bold; margin-right: 10px; }
    .poster { width: 120px; cursor: grab; }
    .controls { margin: 20px 0; }
    button { padding: 6px 12px; margin: 5px; cursor: pointer; border: none; border-radius: 4px; background: #555; color: #fff; }
    button:hover { background: #777; }
    #settingsModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); }
    #settingsContent { background: #222; margin: 10% auto; padding: 20px; width: 300px; border-radius: 6px; }
    .list-section { margin-top: 15px; }
    .list-item { display: flex; justify-content: space-between; align-items: center; margin: 5px 0; }
  </style>
</head>
<body>
  <header>
    <h1>Movies31 Tier List</h1>
  </header>

  <div class="container">
    <div class="controls">
      <input type="text" id="searchInput" placeholder="Search for a movie...">
      <button id="searchBtn">Search</button>
      <button id="settingsBtn">‚öôÔ∏è Settings</button>
      <button id="saveListBtn">üíæ Save List</button>
    </div>

    <div id="searchResults" class="tier"></div>

    <div id="tiers">
      <div class="tier" data-tier="S"><span class="tier-label">S</span></div>
      <div class="tier" data-tier="A"><span class="tier-label">A</span></div>
      <div class="tier" data-tier="B"><span class="tier-label">B</span></div>
      <div class="tier" data-tier="C"><span class="tier-label">C</span></div>
      <div class="tier" data-tier="D"><span class="tier-label">D</span></div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal">
    <div id="settingsContent">
      <h3>Settings</h3>
      <button id="downloadBtn">‚¨áÔ∏è Download Tier List as Image</button>
      <button id="listsBtn">üìÇ Lists</button>
      <button id="closeSettings">Close</button>
    </div>
  </div>

  <!-- Lists Modal -->
  <div id="listsModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7);">
    <div style="background:#222; margin:10% auto; padding:20px; width:350px; border-radius:6px;">
      <h3>Saved Lists</h3>
      <div id="listsContainer"></div>
      <div class="list-section">
        <button id="exportAllBtn">Export All (JSON)</button>
        <input type="file" id="importFile" style="display:none">
        <button id="importBtn">Import JSON</button>
      </div>
      <button id="closeLists">Close</button>
    </div>
  </div>

  <script>
    const apiKey = "thewdb"; // OMDB demo key
    const searchBtn = document.getElementById("searchBtn");
    const searchInput = document.getElementById("searchInput");
    const searchResults = document.getElementById("searchResults");

    searchBtn.addEventListener("click", () => {
      const query = searchInput.value;
      if (!query) return;
      fetch(`https://www.omdbapi.com/?s=${query}&apikey=${apiKey}`)
        .then(res => res.json())
        .then(data => {
          searchResults.innerHTML = "";
          if (data.Search) {
            data.Search.forEach(movie => {
              const img = document.createElement("img");
              img.src = movie.Poster !== "N/A" ? movie.Poster : "https://via.placeholder.com/100x150";
              img.className = "poster";
              img.draggable = true;
              img.dataset.title = movie.Title;
              searchResults.appendChild(img);
            });
          }
        });
    });

    // Drag & Drop
    document.addEventListener("dragstart", e => {
      if (e.target.classList.contains("poster")) {
        e.dataTransfer.setData("text/plain", e.target.src + "||" + e.target.dataset.title);
      }
    });

    document.querySelectorAll(".tier").forEach(tier => {
      tier.addEventListener("dragover", e => e.preventDefault());
      tier.addEventListener("drop", e => {
        e.preventDefault();
        const data = e.dataTransfer.getData("text/plain").split("||");
        const img = document.createElement("img");
        img.src = data[0];
        img.dataset.title = data[1];
        img.className = "poster";
        img.draggable = true;
        tier.appendChild(img);
      });
    });

    // Settings modal
    const settingsBtn = document.getElementById("settingsBtn");
    const settingsModal = document.getElementById("settingsModal");
    const closeSettings = document.getElementById("closeSettings");
    settingsBtn.onclick = () => settingsModal.style.display = "block";
    closeSettings.onclick = () => settingsModal.style.display = "none";

    // Lists modal
    const listsBtn = document.getElementById("listsBtn");
    const listsModal = document.getElementById("listsModal");
    const closeLists = document.getElementById("closeLists");
    listsBtn.onclick = () => { renderLists(); listsModal.style.display = "block"; };
    closeLists.onclick = () => listsModal.style.display = "none";

    // Save List
    const saveListBtn = document.getElementById("saveListBtn");
    saveListBtn.onclick = () => {
      const listName = prompt("Enter a name for this list:");
      if (!listName) return;
      const tiers = {};
      document.querySelectorAll(".tier").forEach(tier => {
        const label = tier.dataset.tier || "Search";
        tiers[label] = [];
        tier.querySelectorAll(".poster").forEach(img => {
          tiers[label].push({ src: img.src, title: img.dataset.title });
        });
      });
      let saved = JSON.parse(localStorage.getItem("tierLists") || "[]");
      saved.unshift({ name: listName, data: tiers, date: new Date().toLocaleString() });
      localStorage.setItem("tierLists", JSON.stringify(saved));
      alert("List saved!");
    };

    // Render saved lists
    function renderLists() {
      const container = document.getElementById("listsContainer");
      container.innerHTML = "";
      const saved = JSON.parse(localStorage.getItem("tierLists") || "[]");
      if (!saved.length) { container.innerHTML = "<p>No saved lists</p>"; return; }
      saved.forEach((list, idx) => {
        const div = document.createElement("div");
        div.className = "list-item";
        div.innerHTML = `<span>${list.name} (${list.date})</span>`;
        const loadBtn = document.createElement("button");
        loadBtn.textContent = "Load";
        loadBtn.onclick = () => loadList(idx);
        const delBtn = document.createElement("button");
        delBtn.textContent = "Delete";
        delBtn.onclick = () => { saved.splice(idx,1); localStorage.setItem("tierLists", JSON.stringify(saved)); renderLists(); };
        div.appendChild(loadBtn);
        div.appendChild(delBtn);
        container.appendChild(div);
      });
    }

    // Load a list
    function loadList(index) {
      const saved = JSON.parse(localStorage.getItem("tierLists") || "[]");
      const list = saved[index];
      if (!list) return;
      document.querySelectorAll(".tier").forEach(tier => tier.innerHTML = `<span class=\"tier-label\">${tier.dataset.tier}</span>`);
      Object.keys(list.data).forEach(label => {
        const tier = document.querySelector(`.tier[data-tier='${label}']`);
        if (tier) {
          list.data[label].forEach(item => {
            const img = document.createElement("img");
            img.src = item.src;
            img.dataset.title = item.title;
            img.className = "poster";
            img.draggable = true;
            tier.appendChild(img);
          });
        }
      });
      listsModal.style.display = "none";
    }

    // Export All
    document.getElementById("exportAllBtn").onclick = () => {
      const saved = localStorage.getItem("tierLists") || "[]";
      const blob = new Blob([saved], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "tierlists.json";
      a.click();
    };

    // Import JSON
    document.getElementById("importBtn").onclick = () => document.getElementById("importFile").click();
    document.getElementById("importFile").onchange = e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => {
        try {
          const imported = JSON.parse(ev.target.result);
          localStorage.setItem("tierLists", JSON.stringify(imported));
          renderLists();
          alert("Lists imported!");
        } catch {
          alert("Invalid JSON");
        }
      };
      reader.readAsText(file);
    };
  </script>
</body>
</html>
